import{l as ee,E as q,d as he,u as ge,ai as le,a as te,B as re,r as u,n as C,x as S,D as s,s as m,a0 as De,H as oe,a5 as be,A as t,F as A,G as y,m as M,a7 as v,a6 as xe}from"./ckeditor-2db82a36.js";import{c as Ve,Q as Ce}from"./vm-8acb4ab5.js";import{u as Se,a as ke,b as Pe}from"./use-checkbox-5f3c2cd8.js";import{Q as g}from"./QInput-92c09ed8.js";import{Q as b}from"./QSelect-bed325f1.js";import{Q as V}from"./QBtn-7730d556.js";import{C as we,D as Fe,u as Te}from"./refList-0a28c396.js";import{a as Ie,u as Ue}from"./index-5f38ae09.js";import{S as E,u as ne}from"./app-3a450106.js";import{Q as Qe,a as qe}from"./QCardActions-10222370.js";import{Q as x}from"./QCardSection-179f6214.js";import{Q as Ae}from"./QImg-c1b5f080.js";import{Q as B}from"./QChip-5d519ab4.js";import{Q as ae}from"./QCard-e317547d.js";import{Q as Me}from"./QDialog-e6831ada.js";import{C as Ee}from"./ClosePopup-c862ef9f.js";import"./option-sizes-38d363f3.js";import"./use-key-composition-fefc29af.js";import"./QMenu-5921cef6.js";import"./use-tick-c308625a.js";import"./rtl-36dd996b.js";import"./format-7985d814.js";import"./use-prevent-scroll-980b8771.js";const Be=Ve({name:"QToggle",props:{...Se,icon:String,iconColor:String},emits:ke,setup(l){function o(i,e){const d=ee(()=>(i.value===!0?l.checkedIcon:e.value===!0?l.indeterminateIcon:l.uncheckedIcon)||l.icon),p=ee(()=>i.value===!0?l.iconColor:null);return()=>[q("div",{class:"q-toggle__track"}),q("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},d.value!==void 0?[q(Ce,{name:d.value,color:p.value})]:void 0)]}return Pe("toggle",o)}}),se="/api/server-files/",Le=he("server_image_admin",{state:()=>({post_image_admin:null,router:ge(),route:le()}),actions:{async updateFiles(l,o){const i={headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}};try{const e=await te.post(se+"update",l,i);return E.fire({text:"Image Update Successfully",icon:"success"}).then(d=>{d.isConfirmed&&this.router.go(0)}),e.data}catch(e){return E.fire({title:e.response.data.data,text:e.response.data.message,icon:"error"}),e.response}},async deleteFiles(l,o){const i={headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}};try{const e=await te.post(se+"delete",l,i);return E.fire({text:"Image Deleted Successfully",icon:"success"}).then(d=>{d.isConfirmed&&this.router.go(0)}),e.data}catch(e){throw console.error("Error:",e),e}},handleMultipleImageChange(l,o){const i=o.target,e=i.id,d=i.files[0],p=i.getAttribute("file_index"),a=i.getAttribute("module_path"),c=l.value.find(_=>_.id===e&&_.module_path===a);return l.value.includes(c)?l.value[p].file=d:l.value.push({id:e,file:d,module_path:a}),l}}});const je={props:["property"],setup(l){const o=ne(),i=Le(),e=o.fetchSessionToken(),d=u(!1),p=u([]),a=[l.property.banner,...l.property.sliders].filter(f=>f!==null);return{existImageModal:d,updateFileData:async()=>{const f=await i.updateFiles(p.value,e);return d.value=!1,f},onFileChange:f=>i.handleMultipleImageChange(p,f),handleDeleteFile:async f=>{const D=await i.deleteFiles(f,e);return d.value=!1,D},finalFiles:a}}},Re=t("div",{class:"text-h5"},"Edit",-1),Ne={class:"col row"},ze={class:"col"},Oe={class:"text-subtitle1 break-words"},Ge={class:"text-subtitle2"},He={class:"text-subtitle2"},Je=["id","module_path","file_index"];function Ke(l,o,i,e,d,p){return C(),S(oe,null,[s(V,{label:"Edit",color:"primary",onClick:o[0]||(o[0]=a=>e.existImageModal=!0),class:"edit-image-form__button"}),s(Me,{modelValue:e.existImageModal,"onUpdate:modelValue":o[2]||(o[2]=a=>e.existImageModal=a)},{default:m(()=>[s(ae,null,{default:m(()=>[s(x,{class:"row items-center"},{default:m(()=>[Re,s(Qe),De(s(V,{icon:"close",flat:"",round:"",dense:""},null,512),[[Ee]])]),_:1}),s(x,{class:"q-pt-none q-gutter-y-lg row"},{default:m(()=>[(C(!0),S(oe,null,be(e.finalFiles,(a,c)=>(C(),S("div",{class:"col-12 row items-center",key:c},[t("div",Ne,[t("div",ze,[s(ae,{class:"my-card"},{default:m(()=>[s(Ae,{src:a.image.url,ratio:16/9,fit:"contain"},null,8,["src"]),s(x,null,{default:m(()=>[t("div",Oe,[s(B,{color:"primary","text-color":"white"},{default:m(()=>[A(y(a.image.name),1)]),_:2},1024)]),t("div",Ge,[s(B,{color:"teal","text-color":"white",icon:"bookmark"},{default:m(()=>[A(y(Math.round(a.image.size/1e3)+"kb"),1)]),_:2},1024)]),t("div",He,[s(B,{color:"teal","text-color":"white",icon:"bookmark"},{default:m(()=>[A(y(a.image.module_path),1)]),_:2},1024)])]),_:2},1024),s(x,{class:"justify-center flex"},{default:m(()=>[s(x,{class:"col-8"},{default:m(()=>[t("input",{type:"file",multiple:"",name:"file",id:a.id,module_path:a.image.module_path,file_index:c,class:"hidden-input",onChange:o[1]||(o[1]=(..._)=>e.onFileChange&&e.onFileChange(..._)),ref_for:!0,ref:"currentFile",accept:".pdf,.jpg,.jpeg,.png"},null,40,Je)]),_:2},1024)]),_:2},1024),s(x,{class:"justify-center flex"},{default:m(()=>[s(V,{size:"14px",round:"",color:"red",icon:"delete",onClick:_=>e.handleDeleteFile(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])])]))),128))]),_:1}),s(qe,{align:"right"},{default:m(()=>[s(V,{label:"Update",class:"text-white bg-primary update-form__button",onClick:e.updateFileData},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const We=re(je,[["render",Ke]]);const Xe={components:{CkeditorPlugin:we,DropFile:Fe,ExistImageModal:We},async setup(){var H,J;const l=le(),o=((H=l.query)==null?void 0:H.type)||null,i=((J=l.query)==null?void 0:J.id)||null,e=Ie(),d=Te(),p=Ue(),a=u(e.fetchPropertyData()),c=u(e.fetchPropertyDetailsData()),_=u(e.fetchPropertyError()),r=u([]),f=u(0),D=u(!1),L=u([]),j=u([]),ie=u(null),R=u(""),N=u(""),de=u(!1),k=ne().fetchSessionToken(),P=e.fetchTenureData(),w=e.fetchFurnishingData(),F=e.fetchListingTypeData(),z=e.fetchStatusData();a.value.listing_type=F.find(n=>n.slug==="sale"),a.value.status=z.find(n=>n.slug==="active"),c.value.tenure=P.find(n=>n.slug==="freehold"),c.value.furnishing=w.find(n=>n.slug==="unfurnished");const O=async()=>{const n=await d.fetchStateList(k);L.value=n},T=async()=>{const n=await d.fetchPropertyTypes(k);return j.value=n,n},pe=()=>(f.value=D.value?1:0,f.value),ce=n=>{a.value={...a.value,images:n.files,module_path:n.module_path}},ue=n=>{R.value=URL.createObjectURL(n.target.files[0]),N.value=n.target.files[0]},me=n=>{a.value.description=n},G=async()=>{const n=await T(),K=await p.findProperty(k,i),{name:W,description:X,short_description:Y,state:Z,price:I,file:$,banner:U,sliders:Q,type:fe,details:h,listing_type:ye}=K;a.value={...a.value,name:W,description:X,short_description:Y,state:Z,price:I,file:$,banner:U,sliders:Q,property_types:p.filteredPropertyDetails({type:n,details:fe,category:"propertyType"}),listing_type:ye},a.value.listing_type=F.find(ve=>ve.slug===a.value.listing_type),h&&(D.value=!0,c.value={...c.value,tenure:p.filteredPropertyDetails({type:P,details:h.tenure}),square_feet:h.square_feet,furnishing:p.filteredPropertyDetails({type:w,details:h.furnishing}),bedroom:h.bedroom,bathroom:h.bathroom,car_park:h.car_park})},_e=async()=>{a.value={...a.value,property_details:D.value?1:0,banner_url:N.value};const{tenure:n,bathroom:K,bedroom:W,car_park:X,square_feet:Y,furnishing:Z,...I}=a.value;return a.value=I,a.value.property_details>0&&(a.value={...a.value,...Object.fromEntries(Object.entries(c.value).map(([U,Q])=>[U,Q??null]))}),console.log(a.value),await p.createProperty(k,a.value,_)};return o==="update"&&await G(),await O(),await T(),{findProperty:G,propertyData:a,propertyDetailsData:c,submitData:_e,updateParentFiles:ce,updateDescriptions:me,propertyDetailsToggle:D,handlePropertyDetails:pe,options:r,errors:_,tenure:P,furnishing:w,listingType:F,status:z,state:L,property_types:j,stateList:O,propertyTypesList:T,mainImage:ie,bannerUrl:R,updateMainImage:ue,routeType:o,existImageModal:de}}},Ye={class:"row"},Ze={class:"col-12 row pb-4"},$e=t("div",{class:"col text-2xl"},"Property Form",-1),et={class:"col text-right"},tt=t("span",{class:"font-bold"},"Details",-1),ot={class:"col-12 row bg-white p-5 font-bold gap-y-4"},at={class:"col-12 post-information-name pb-2"},st={class:"col-12"},lt=t("div",{class:"post-information-name"},"Name",-1),rt={class:"col-12"},nt={class:"col-12 text-red-700 pt-2"},it={class:"col-12"},dt=t("div",{class:"post-information-name"},"Descriptions",-1),pt={class:"col-12"},ct={class:"col-12 text-red-700 pt-2"},ut={class:"col-12"},mt=t("div",{class:"post-information-name"},"Short Descriptions",-1),_t={class:"col-12"},ft={class:"col-12 text-red-700 pt-2"},yt=t("div",{class:"post-information-name"},"Status",-1),vt={class:"col-12 col-md-6"},ht=t("div",{class:"post-information-name"},"Types",-1),gt={class:"col-12 text-red-700 pt-2"},Dt=t("div",{class:"post-information-name"},"State",-1),bt={class:"col-12 text-red-700 pt-2"},xt={class:"col-12 col-md-6"},Vt=t("div",{class:"post-information-name"},"Price",-1),Ct=t("div",{class:"post-information-name"},"Listing Type",-1),St=t("div",{class:"post-information-name"},"Tenure",-1),kt={class:"col-12 col-md-6"},Pt=t("div",{class:"post-information-name"},"Square Feet",-1),wt=t("div",{class:"post-information-name"},"Furnished Type",-1),Ft=t("div",{class:"post-information-name"},"Bathroom",-1),Tt=t("div",{class:"post-information-name"},"Bedroom",-1),It={class:"col-12 col-md-6"},Ut=t("div",{class:"post-information-name"},"Car Park",-1),Qt={class:"col-12"},qt={class:"flex justify-between py-2"},At=t("div",{class:"post-information__name"},"Images",-1),Mt={key:0},Et={class:"col-12 text-red-700 pt-2"},Bt={class:"col-12 text-right"};function Lt(l,o,i,e,d,p){const a=M("CkeditorPlugin"),c=M("ExistImageModal"),_=M("DropFile");return C(),S("div",Ye,[t("div",Ze,[$e,t("div",et,[tt,s(Be,{modelValue:e.propertyDetailsToggle,"onUpdate:modelValue":o[0]||(o[0]=r=>e.propertyDetailsToggle=r),color:"green",onClick:e.handlePropertyDetails},null,8,["modelValue","onClick"])])]),t("div",ot,[t("div",at,y(e.routeType=="update"?"Update":"Create")+" Property ",1),t("div",st,[lt,t("div",rt,[s(g,{dense:"",outlined:"",label:"Name",modelValue:e.propertyData.name,"onUpdate:modelValue":o[1]||(o[1]=r=>e.propertyData.name=r),ref:"nameRef"},null,8,["modelValue"])]),t("div",nt,y(e.errors.name),1)]),t("div",it,[dt,t("div",pt,[s(a,{description:e.propertyData.description,onUpdateDescriptionsData:e.updateDescriptions},null,8,["description","onUpdateDescriptionsData"])]),t("div",ct,y(e.errors.description),1)]),t("div",ut,[mt,t("div",_t,[s(g,{modelValue:e.propertyData.short_description,"onUpdate:modelValue":o[2]||(o[2]=r=>e.propertyData.short_description=r),filled:"",outlined:"",placeholder:"Short Descriptions",type:"textarea"},null,8,["modelValue"])]),t("div",ft,y(e.errors.short_description),1)]),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[yt,s(b,{dense:"",modelValue:e.propertyData.status,"onUpdate:modelValue":o[3]||(o[3]=r=>e.propertyData.status=r),options:e.status,"option-value":"slug","option-label":"label",label:"Status"},null,8,["modelValue","options"])],2),t("div",vt,[ht,s(b,{dense:"",modelValue:e.propertyData.property_types,"onUpdate:modelValue":o[4]||(o[4]=r=>e.propertyData.property_types=r),options:e.property_types,"option-value":"id","option-label":"label",label:"Please Select"},null,8,["modelValue","options"]),t("div",gt,y(e.errors.type_id),1)]),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[Dt,s(b,{dense:"",modelValue:e.propertyData.state,"onUpdate:modelValue":o[5]||(o[5]=r=>e.propertyData.state=r),options:e.state,"option-value":"id","option-label":"label",label:"Please Select"},null,8,["modelValue","options"]),t("div",bt,y(e.errors.state_id),1)],2),t("div",xt,[Vt,s(g,{dense:"",outlined:"",label:"Price",modelValue:e.propertyData.price,"onUpdate:modelValue":o[6]||(o[6]=r=>e.propertyData.price=r),type:"number"},null,8,["modelValue"])]),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[Ct,s(b,{dense:"",modelValue:e.propertyData.listing_type,"onUpdate:modelValue":o[7]||(o[7]=r=>e.propertyData.listing_type=r),options:e.listingType,label:"Please Select","emit-value":"","map-options":""},null,8,["modelValue","options"])],2),t("div",{class:v(["col-12 row gap-y-4",e.propertyDetailsToggle?"":"hidden"])},[t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[St,s(b,{dense:"",modelValue:e.propertyDetailsData.tenure,"onUpdate:modelValue":o[8]||(o[8]=r=>e.propertyDetailsData.tenure=r),options:e.tenure,label:"Please Select","emit-value":"","map-options":""},null,8,["modelValue","options"])],2),t("div",kt,[Pt,s(g,{dense:"",outlined:"",label:"Square Feet",modelValue:e.propertyDetailsData.square_feet,"onUpdate:modelValue":o[9]||(o[9]=r=>e.propertyDetailsData.square_feet=r),type:"number"},null,8,["modelValue"])]),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[wt,s(b,{dense:"",modelValue:e.propertyDetailsData.furnishing,"onUpdate:modelValue":o[10]||(o[10]=r=>e.propertyDetailsData.furnishing=r),options:e.furnishing,label:"Please Select","emit-value":"","map-options":""},null,8,["modelValue","options"])],2),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[Ft,s(g,{dense:"",outlined:"",label:"Bathroom",modelValue:e.propertyDetailsData.bathroom,"onUpdate:modelValue":o[11]||(o[11]=r=>e.propertyDetailsData.bathroom=r),type:"number"},null,8,["modelValue"])],2),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[Tt,s(g,{dense:"",outlined:"",label:"Bedroom",modelValue:e.propertyDetailsData.bedroom,"onUpdate:modelValue":o[12]||(o[12]=r=>e.propertyDetailsData.bedroom=r),type:"number"},null,8,["modelValue"])],2),t("div",It,[Ut,s(g,{dense:"",outlined:"",label:"Carpark",modelValue:e.propertyDetailsData.car_park,"onUpdate:modelValue":o[13]||(o[13]=r=>e.propertyDetailsData.car_park=r),type:"number"},null,8,["modelValue"])])],2),t("div",Qt,[t("div",qt,[At,e.routeType==="update"?(C(),S("div",Mt,[s(c,{property:e.propertyData},null,8,["property"])])):xe("",!0)]),s(_,{onUpdateFiles:e.updateParentFiles,propertyData:e.propertyData},null,8,["onUpdateFiles","propertyData"]),t("div",Et,y(e.errors.module_path),1)]),t("div",Bt,[s(V,{label:e.routeType=="update"?"Update":"Submit",class:"text-white bg-primary update-form__button",onClick:e.submitData},null,8,["label","onClick"])])])])}const co=re(Xe,[["render",Lt]]);export{co as default};
