import{l as ee,E as U,d as ve,u as he,ai as le,a as te,B as re,r as p,n as C,x as S,D as a,s as u,a3 as ge,H as oe,a5 as De,A as t,F as Q,G as v,m as A,a7 as D,a6 as be}from"./ckeditor-b3f36c6d.js";import{c as xe,Q as Ve}from"./vm-66c05f2a.js";import{u as Ce,a as Se,b as ke}from"./use-checkbox-e6dbdfad.js";import{Q as h}from"./QInput-89c7e163.js";import{Q as b}from"./QSelect-c10ac667.js";import{Q as V}from"./QBtn-d4f72e44.js";import{C as Pe,D as we,u as Fe}from"./refList-bad24b18.js";import{a as Te,u as Ie}from"./index-f23749c6.js";import{S as q,u as ne}from"./app-e9913e8b.js";import{Q as Ue,a as Qe}from"./QCardActions-d8a0140e.js";import{Q as x}from"./QCardSection-4a7861ca.js";import{Q as Ae}from"./QImg-85c429cb.js";import{Q as M}from"./QChip-74f01bae.js";import{Q as ae}from"./QCard-0b7be12c.js";import{Q as qe}from"./QDialog-f59f8082.js";import{C as Me}from"./ClosePopup-8871498c.js";import"./option-sizes-265dbe9b.js";import"./use-key-composition-8049d5b3.js";import"./QMenu-e31f52bc.js";import"./use-timeout-e1ce1bfc.js";import"./rtl-36dd996b.js";import"./format-7985d814.js";import"./use-prevent-scroll-41abe4ad.js";const Ee=xe({name:"QToggle",props:{...Ce,icon:String,iconColor:String},emits:Se,setup(r){function o(n,e){const i=ee(()=>(n.value===!0?r.checkedIcon:e.value===!0?r.indeterminateIcon:r.uncheckedIcon)||r.icon),d=ee(()=>n.value===!0?r.iconColor:null);return()=>[U("div",{class:"q-toggle__track"}),U("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},i.value!==void 0?[U(Ve,{name:i.value,color:d.value})]:void 0)]}return ke("toggle",o)}}),se="/api/server-files/",Be=ve("server_image_admin",{state:()=>({post_image_admin:null,router:he(),route:le()}),actions:{async updateFiles(r,o){const n={headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}};try{const e=await te.post(se+"update",r,n);return q.fire({text:"Image Update Successfully",icon:"success"}).then(i=>{i.isConfirmed&&this.router.go(0)}),e.data}catch(e){return q.fire({title:e.response.data.data,text:e.response.data.message,icon:"error"}),e.response}},async deleteFiles(r,o){const n={headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}};try{const e=await te.post(se+"delete",r,n);return q.fire({text:"Image Deleted Successfully",icon:"success"}).then(i=>{i.isConfirmed&&this.router.go(0)}),e.data}catch(e){throw console.error("Error:",e),e}},handleMultipleImageChange(r,o){const n=o.target,e=n.id,i=n.files[0],d=n.getAttribute("file_index"),s=n.getAttribute("module_path"),m=r.value.find(_=>_.id===e&&_.module_path===s);return r.value.includes(m)?r.value[d].file=i:r.value.push({id:e,file:i,module_path:s}),r}}});const Le={props:["property"],setup(r){const o=ne(),n=Be(),e=o.fetchSessionToken(),i=p(!1),d=p([]),s=[r.property.banner,...r.property.sliders].filter(f=>f!==null);return{existImageModal:i,updateFileData:async()=>{const f=await n.updateFiles(d.value,e);return i.value=!1,f},onFileChange:f=>n.handleMultipleImageChange(d,f),handleDeleteFile:async f=>{const g=await n.deleteFiles(f,e);return i.value=!1,g},finalFiles:s}}},je=t("div",{class:"text-h5"},"Edit",-1),Re={class:"col row"},Ne={class:"col"},ze={class:"text-subtitle1 break-words"},Oe={class:"text-subtitle2"},Ge={class:"text-subtitle2"},He=["id","module_path","file_index"];function Je(r,o,n,e,i,d){return C(),S(oe,null,[a(V,{label:"Edit",color:"primary",onClick:o[0]||(o[0]=s=>e.existImageModal=!0),class:"edit-image-form__button"}),a(qe,{modelValue:e.existImageModal,"onUpdate:modelValue":o[2]||(o[2]=s=>e.existImageModal=s)},{default:u(()=>[a(ae,null,{default:u(()=>[a(x,{class:"row items-center"},{default:u(()=>[je,a(Ue),ge(a(V,{icon:"close",flat:"",round:"",dense:""},null,512),[[Me]])]),_:1}),a(x,{class:"q-pt-none q-gutter-y-lg row"},{default:u(()=>[(C(!0),S(oe,null,De(e.finalFiles,(s,m)=>(C(),S("div",{class:"col-12 row items-center",key:m},[t("div",Re,[t("div",Ne,[a(ae,{class:"my-card"},{default:u(()=>[a(Ae,{src:s.image.url,ratio:16/9,fit:"contain"},null,8,["src"]),a(x,null,{default:u(()=>[t("div",ze,[a(M,{color:"primary","text-color":"white"},{default:u(()=>[Q(v(s.image.name),1)]),_:2},1024)]),t("div",Oe,[a(M,{color:"teal","text-color":"white",icon:"bookmark"},{default:u(()=>[Q(v(Math.round(s.image.size/1e3)+"kb"),1)]),_:2},1024)]),t("div",Ge,[a(M,{color:"teal","text-color":"white",icon:"bookmark"},{default:u(()=>[Q(v(s.image.module_path),1)]),_:2},1024)])]),_:2},1024),a(x,{class:"justify-center flex"},{default:u(()=>[a(x,{class:"col-8"},{default:u(()=>[t("input",{type:"file",multiple:"",name:"file",id:s.id,module_path:s.image.module_path,file_index:m,class:"hidden-input",onChange:o[1]||(o[1]=(..._)=>e.onFileChange&&e.onFileChange(..._)),ref_for:!0,ref:"currentFile",accept:".pdf,.jpg,.jpeg,.png"},null,40,He)]),_:2},1024)]),_:2},1024),a(x,{class:"justify-center flex"},{default:u(()=>[a(V,{size:"14px",round:"",color:"red",icon:"delete",onClick:_=>e.handleDeleteFile(s)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])])]))),128))]),_:1}),a(Qe,{align:"right"},{default:u(()=>[a(V,{label:"Update",class:"text-white bg-primary update-form__button",onClick:e.updateFileData},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const Ke=re(Le,[["render",Je]]);const We={components:{CkeditorPlugin:Pe,DropFile:we,ExistImageModal:Ke},async setup(){var H,J;const r=le(),o=((H=r.query)==null?void 0:H.type)||null,n=((J=r.query)==null?void 0:J.id)||null,e=Te(),i=Fe(),d=Ie(),s=p(e.fetchPropertyData()),m=p(e.fetchPropertyDetailsData()),_=p(e.fetchPropertyError()),l=p([]),f=p(0),g=p(!1),E=p([]),B=p([]),ie=p(null),L=p(""),j=p(""),de=p(!1);s.value.status="Active";const k=ne().fetchSessionToken(),R=e.fetchTenureData(),N=e.fetchFurnishingData(),z=e.fetchListingTypeData(),ce=e.fetchStatusData(),O=async()=>{const c=await i.fetchStateList(k);E.value=c},F=async()=>{const c=await i.fetchPropertyTypes(k);return B.value=c,c},pe=()=>(f.value=g.value?1:0,f.value),ue=c=>{s.value={...s.value,images:c.files,module_path:c.module_path}},me=c=>{L.value=URL.createObjectURL(c.target.files[0]),j.value=c.target.files[0]},_e=c=>{s.value.description=c},G=async()=>{const c=await F(),T=await d.findProperty(k,n);console.log(T);const{name:K,description:W,short_description:X,state:Y,price:Z,file:I,banner:$,sliders:P,type:w,details:y}=T;s.value={...s.value,name:K,description:W,short_description:X,state:Y,price:Z,file:I,banner:$,sliders:P,property_types:d.filteredPropertyDetails({type:c,details:w,category:"propertyType"})},y&&(g.value=!0,m.value={...m.value,tenure:d.filteredPropertyDetails({type:R,details:y.tenure}),square_feet:y.square_feet,listing_type:d.filteredPropertyDetails({type:z,details:y.listing_type}),furnishing:d.filteredPropertyDetails({type:N,details:y.furnishing}),bedroom:y.bedroom,bathroom:y.bathroom,car_park:y.car_park})},fe=async()=>{var P,w;s.value={...s.value,property_details:g.value?1:0,status:{slug:((P=s.value.status)==null?void 0:P.slug)||"active",label:((w=s.value.status)==null?void 0:w.label)||"Active"},banner_url:j.value};const{tenure:c,bathroom:T,bedroom:K,car_park:W,square_feet:X,listing_type:Y,furnishing:Z,...I}=s.value;return s.value=I,s.value.property_details>0&&(s.value={...s.value,...Object.fromEntries(Object.entries(m.value).map(([y,ye])=>[y,ye??null]))}),await d.createProperty(k,s.value,_)};return o==="update"&&await G(),await O(),await F(),{findProperty:G,propertyData:s,propertyDetailsData:m,submitData:fe,updateParentFiles:ue,updateDescriptions:_e,propertyDetailsToggle:g,handlePropertyDetails:pe,options:l,errors:_,tenure:R,furnishing:N,listingType:z,status:ce,state:E,property_types:B,stateList:O,propertyTypesList:F,mainImage:ie,bannerUrl:L,updateMainImage:me,routeType:o,existImageModal:de}}},Xe={class:"row"},Ye={class:"col-12 row pb-4"},Ze=t("div",{class:"col text-2xl"},"Property Form",-1),$e={class:"col text-right"},et=t("span",{class:"font-bold"},"Details",-1),tt={class:"col-12 row bg-white p-5 font-bold gap-y-4"},ot={class:"col-12 post-information-name pb-2"},at={class:"col-12"},st=t("div",{class:"post-information-name"},"Name",-1),lt={class:"col-12"},rt={class:"col-12 text-red-700 pt-2"},nt={class:"col-12"},it=t("div",{class:"post-information-name"},"Descriptions",-1),dt={class:"col-12"},ct={class:"col-12 text-red-700 pt-2"},pt={class:"col-12"},ut=t("div",{class:"post-information-name"},"Short Descriptions",-1),mt={class:"col-12"},_t={class:"col-12 text-red-700 pt-2"},ft=t("div",{class:"post-information-name"},"Status",-1),yt={class:"col-12 col-md-6"},vt=t("div",{class:"post-information-name"},"Types",-1),ht={class:"col-12 text-red-700 pt-2"},gt=t("div",{class:"post-information-name"},"State",-1),Dt={class:"col-12 text-red-700 pt-2"},bt={class:"col-12 col-md-6"},xt=t("div",{class:"post-information-name"},"Price",-1),Vt=t("div",{class:"post-information-name"},"Tenure",-1),Ct={class:"col-12 col-md-6"},St=t("div",{class:"post-information-name"},"Square Feet",-1),kt=t("div",{class:"post-information-name"},"Listing Type",-1),Pt={class:"col-12 col-md-6"},wt=t("div",{class:"post-information-name"},"Furnished Type",-1),Ft=t("div",{class:"post-information-name"},"Bathroom",-1),Tt={class:"col-12 col-md-6"},It=t("div",{class:"post-information-name"},"Bedroom",-1),Ut={class:"col-12"},Qt=t("div",{class:"post-information-name"},"Car Park",-1),At={class:"col-12"},qt={class:"flex justify-between py-2"},Mt=t("div",{class:"post-information__name"},"Images",-1),Et={key:0},Bt={class:"col-12 text-red-700 pt-2"},Lt={class:"col-12 text-right"};function jt(r,o,n,e,i,d){const s=A("CkeditorPlugin"),m=A("ExistImageModal"),_=A("DropFile");return C(),S("div",Xe,[t("div",Ye,[Ze,t("div",$e,[et,a(Ee,{modelValue:e.propertyDetailsToggle,"onUpdate:modelValue":o[0]||(o[0]=l=>e.propertyDetailsToggle=l),color:"green",onClick:e.handlePropertyDetails},null,8,["modelValue","onClick"])])]),t("div",tt,[t("div",ot,v(e.routeType=="update"?"Update":"Create")+" Property ",1),t("div",at,[st,t("div",lt,[a(h,{dense:"",outlined:"",label:"Name",modelValue:e.propertyData.name,"onUpdate:modelValue":o[1]||(o[1]=l=>e.propertyData.name=l),ref:"nameRef"},null,8,["modelValue"])]),t("div",rt,v(e.errors.name),1)]),t("div",nt,[it,t("div",dt,[a(s,{description:e.propertyData.description,onUpdateDescriptionsData:e.updateDescriptions},null,8,["description","onUpdateDescriptionsData"])]),t("div",ct,v(e.errors.description),1)]),t("div",pt,[ut,t("div",mt,[a(h,{modelValue:e.propertyData.short_description,"onUpdate:modelValue":o[2]||(o[2]=l=>e.propertyData.short_description=l),filled:"",outlined:"",placeholder:"Short Descriptions",type:"textarea"},null,8,["modelValue"])]),t("div",_t,v(e.errors.short_description),1)]),t("div",{class:D(["col-12 col-md-6",r.$q.screen.lt.md?"pr-0":"pr-6"])},[ft,a(b,{dense:"",modelValue:e.propertyData.status,"onUpdate:modelValue":o[3]||(o[3]=l=>e.propertyData.status=l),options:e.status,"option-value":"slug","option-label":"label",label:"Status"},null,8,["modelValue","options"])],2),t("div",yt,[vt,a(b,{dense:"",modelValue:e.propertyData.property_types,"onUpdate:modelValue":o[4]||(o[4]=l=>e.propertyData.property_types=l),options:e.property_types,"option-value":"id","option-label":"label",label:"Please Select"},null,8,["modelValue","options"]),t("div",ht,v(e.errors.type_id),1)]),t("div",{class:D(["col-12 col-md-6",r.$q.screen.lt.md?"pr-0":"pr-6"])},[gt,a(b,{dense:"",modelValue:e.propertyData.state,"onUpdate:modelValue":o[5]||(o[5]=l=>e.propertyData.state=l),options:e.state,"option-value":"id","option-label":"label",label:"Please Select"},null,8,["modelValue","options"]),t("div",Dt,v(e.errors.state_id),1)],2),t("div",bt,[xt,a(h,{dense:"",outlined:"",label:"Price",modelValue:e.propertyData.price,"onUpdate:modelValue":o[6]||(o[6]=l=>e.propertyData.price=l),type:"number"},null,8,["modelValue"])]),t("div",{class:D(["col-12 row gap-y-4",e.propertyDetailsToggle?"":"hidden"])},[t("div",{class:D(["col-12 col-md-6",r.$q.screen.lt.md?"pr-0":"pr-6"])},[Vt,a(b,{dense:"",modelValue:e.propertyDetailsData.tenure,"onUpdate:modelValue":o[7]||(o[7]=l=>e.propertyDetailsData.tenure=l),options:e.tenure,"option-value":"slug","option-label":"label",label:"Please Select"},null,8,["modelValue","options"])],2),t("div",Ct,[St,a(h,{dense:"",outlined:"",label:"Square Feet",modelValue:e.propertyDetailsData.square_feet,"onUpdate:modelValue":o[8]||(o[8]=l=>e.propertyDetailsData.square_feet=l),type:"number"},null,8,["modelValue"])]),t("div",{class:D(["col-12 col-md-6",r.$q.screen.lt.md?"pr-0":"pr-6"])},[kt,a(b,{dense:"",modelValue:e.propertyDetailsData.listing_type,"onUpdate:modelValue":o[9]||(o[9]=l=>e.propertyDetailsData.listing_type=l),options:e.listingType,"option-value":"slug","option-label":"label",label:"Please Select"},null,8,["modelValue","options"])],2),t("div",Pt,[wt,a(b,{dense:"",modelValue:e.propertyDetailsData.furnishing,"onUpdate:modelValue":o[10]||(o[10]=l=>e.propertyDetailsData.furnishing=l),options:e.furnishing,"option-value":"slug","option-label":"label",label:"Please Select"},null,8,["modelValue","options"])]),t("div",{class:D(["col-12 col-md-6",r.$q.screen.lt.md?"pr-0":"pr-6"])},[Ft,a(h,{dense:"",outlined:"",label:"Bathroom",modelValue:e.propertyDetailsData.bathroom,"onUpdate:modelValue":o[11]||(o[11]=l=>e.propertyDetailsData.bathroom=l),type:"number"},null,8,["modelValue"])],2),t("div",Tt,[It,a(h,{dense:"",outlined:"",label:"Bedroom",modelValue:e.propertyDetailsData.bedroom,"onUpdate:modelValue":o[12]||(o[12]=l=>e.propertyDetailsData.bedroom=l),type:"number"},null,8,["modelValue"])]),t("div",Ut,[Qt,a(h,{dense:"",outlined:"",label:"Carpark",modelValue:e.propertyDetailsData.car_park,"onUpdate:modelValue":o[13]||(o[13]=l=>e.propertyDetailsData.car_park=l),type:"number"},null,8,["modelValue"])])],2),t("div",At,[t("div",qt,[Mt,e.routeType==="update"?(C(),S("div",Et,[a(m,{property:e.propertyData},null,8,["property"])])):be("",!0)]),a(_,{onUpdateFiles:e.updateParentFiles,propertyData:e.propertyData},null,8,["onUpdateFiles","propertyData"]),t("div",Bt,v(e.errors.module_path),1)]),t("div",Lt,[a(V,{label:e.routeType=="update"?"Update":"Submit",class:"text-white bg-primary update-form__button",onClick:e.submitData},null,8,["label","onClick"])])])])}const uo=re(We,[["render",jt]]);export{uo as default};
