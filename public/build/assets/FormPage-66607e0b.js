import{l as Y,E,d as de,u as ce,a9 as ee,a as M,B as te,r as u,n as b,x,D as s,s as f,R as pe,H as B,T as Z,A as t,F as j,G as y,m as L,W as v,U as ue}from"./ckeditor-02e744e5.js";import{c as me,Q as _e}from"./vm-8d870a05.js";import{u as he,a as fe,b as ye}from"./use-checkbox-4fd9df1c.js";import{Q as D}from"./QInput-0a75a164.js";import{Q as S}from"./QSelect-6b7c8cc4.js";import{Q as F}from"./QBtn-06ca8513.js";import{C as ge,D as ve,u as De}from"./refList-ea54f7de.js";import{a as be,u as xe}from"./index-1b6d1a91.js";import{S as R,u as oe}from"./app-a271eccd.js";import{Q as Ve,a as Se}from"./QCardActions-f5009174.js";import{Q as C}from"./QCardSection-0ce48cb2.js";import{Q as Ce}from"./QImg-552d92c1.js";import{Q as z}from"./QChip-f21ec7ff.js";import{Q as $}from"./QCard-0fcf7a53.js";import{Q as Fe}from"./QDialog-32a3201d.js";import{C as ke}from"./ClosePopup-602f2a34.js";import"./option-sizes-804a0e0d.js";import"./QMenu-2677335d.js";import"./use-tick-5c90f11d.js";import"./rtl-36dd996b.js";import"./format-7985d814.js";import"./use-prevent-scroll-16ed7031.js";const Ie=me({name:"QToggle",props:{...he,icon:String,iconColor:String},emits:fe,setup(l){function o(r,e){const d=Y(()=>(r.value===!0?l.checkedIcon:e.value===!0?l.indeterminateIcon:l.uncheckedIcon)||l.icon),c=Y(()=>r.value===!0?l.iconColor:null);return()=>[E("div",{class:"q-toggle__track"}),E("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},d.value!==void 0?[E(_e,{name:d.value,color:c.value})]:void 0)]}return ye("toggle",o)}}),N="/api/server-files/",we=de("server_image_admin",{state:()=>({post_image_admin:null,router:ce(),route:ee()}),actions:{async updateFiles(l,o){const r={headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}};try{const e=await M.post(N+"update",l,r);return R.fire({text:"Image Update Successfully",icon:"success"}).then(d=>{d.isConfirmed&&this.router.go(0)}),e.data}catch(e){return R.fire({title:e.response.data.data,text:e.response.data.message,icon:"error"}),e.response}},async deleteFiles(l,o){const r={headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}};try{const e=await M.post(N+"delete",l,r);return R.fire({text:"Image Deleted Successfully",icon:"success"}).then(d=>{d.isConfirmed&&this.router.go(0)}),e.data}catch(e){throw console.error("Error:",e),e}},findIncomingFiles(l,o){return l.value.find(r=>r.id===o)||null},handleMultipleImageChange(l,o){const r=o.target,e=parseInt(r.id),d=r.files[0],c=r.getAttribute("index"),a=r.getAttribute("module_path");return this.findIncomingFiles(l,e)?l.value[c].file=d:l.value.push({id:e,file:d,module_path:a}),l},async updateSequence(l,o){const r={headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}};try{return(await M.post(N+"sequence",l,r)).data}catch{}},async handleExistImageSequence(l,o=null){const{eventTarget:r,incomingFiles:e,fileId:d}=l,c=r.getAttribute("module_path"),a={id:d,sequences:parseInt(r.value),module_path:c,entity_id:this.route.query.id};return e.value.push(a),{list:await this.updateSequence(a,o),sequence:e.value}}}});const Pe={props:["property"],setup(l){const o=oe(),r=we(),e=o.fetchSessionToken(),d=u(!1),c=u([]),a=u([]);return a.value=[l.property.banner,...l.property.sliders].filter(_=>_!==null),{existImageModal:d,updateFileData:async()=>{const _=await r.updateFiles(c.value,e);return d.value=!1,_},handleFileChange:_=>r.handleMultipleImageChange(c,_),handleDeleteFile:async _=>{const V=await r.deleteFiles(_,e);return d.value=!1,V},finalFiles:a,handleExistImageSequence:async(_,V)=>{const k={eventTarget:_.target,fileId:V,incomingFiles:c},I=await r.handleExistImageSequence(k,e);return a.value=I.list.data,I.sequence}}}},qe=t("div",{class:"text-h5"},"Edit",-1),Te={class:"col row"},Ue={class:"col"},Qe={class:"text-subtitle1 break-words"},Ae={class:"text-subtitle2"},Ee={class:"text-subtitle2"},Me=["id","index","module_path","onChange"],Be=["value","selected"],je=["id","module_path","index"];function Le(l,o,r,e,d,c){return b(),x(B,null,[s(F,{label:"Edit",color:"primary",onClick:o[0]||(o[0]=a=>e.existImageModal=!0),class:"edit-image-form__button"}),s(Fe,{modelValue:e.existImageModal,"onUpdate:modelValue":o[2]||(o[2]=a=>e.existImageModal=a)},{default:f(()=>[s($,null,{default:f(()=>[s(C,{class:"row items-center"},{default:f(()=>[qe,s(Ve),pe(s(F,{icon:"close",flat:"",round:"",dense:""},null,512),[[ke]])]),_:1}),s(C,{class:"q-pt-none q-gutter-y-lg row"},{default:f(()=>[(b(!0),x(B,null,Z(e.finalFiles,(a,p)=>(b(),x("div",{class:"col-12 row items-center",key:p},[t("div",Te,[t("div",Ue,[s($,{class:"my-card"},{default:f(()=>[s(Ce,{src:a.image.url,ratio:16/9,fit:"contain"},null,8,["src"]),s(C,null,{default:f(()=>[t("div",Qe,[s(z,{color:"primary","text-color":"white"},{default:f(()=>[j(y(a.image.name),1)]),_:2},1024)]),t("div",Ae,[s(z,{color:"teal","text-color":"white",icon:"bookmark"},{default:f(()=>[j(y(Math.round(a.image.size/1e3)+"kb"),1)]),_:2},1024)]),t("div",Ee,[s(z,{color:"teal","text-color":"white",icon:"bookmark"},{default:f(()=>[j(y(a.image.module_path),1)]),_:2},1024)]),t("div",null,[t("select",{name:"",id:parseInt(a.id),index:p,module_path:a.image.module_path,onChange:m=>e.handleExistImageSequence(m,a.id)},[(b(!0),x(B,null,Z(e.finalFiles.length,(m,n)=>(b(),x("option",{value:m,key:n,selected:a.seq_value===m},y(m),9,Be))),128))],40,Me)])]),_:2},1024),s(C,{class:"justify-center flex"},{default:f(()=>[s(C,{class:"col-8"},{default:f(()=>[t("input",{type:"file",multiple:"",name:"file",id:a.id,module_path:a.image.module_path,index:p,class:"hidden-input",onChange:o[1]||(o[1]=(...m)=>e.handleFileChange&&e.handleFileChange(...m)),ref_for:!0,ref:"currentFile",accept:".pdf,.jpg,.jpeg,.png"},null,40,je)]),_:2},1024)]),_:2},1024),s(C,{class:"justify-center flex"},{default:f(()=>[s(F,{size:"14px",round:"",color:"red",icon:"delete",onClick:m=>e.handleDeleteFile(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])])]))),128))]),_:1}),s(Se,{align:"right"},{default:f(()=>[s(F,{label:"Update",class:"text-white bg-primary update-form__button",onClick:e.updateFileData},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const Re=te(Pe,[["render",Le]]);const ze={components:{CkeditorPlugin:ge,DropFile:ve,ExistImageModal:Re},async setup(){var J,X;const l=ee(),o=((J=l.query)==null?void 0:J.type)||null,r=((X=l.query)==null?void 0:X.id)||null,e=be(),d=De(),c=xe(),a=u(e.fetchPropertyData()),p=u(e.fetchPropertyDetailsData()),m=u(e.fetchPropertyError()),n=u([]),P=u(0),_=u(!1),V=u([]),k=u([]),I=u(null),O=u(""),G=u(""),ae=u(!1),w=oe().fetchSessionToken(),q=e.fetchTenureData(),T=e.fetchFurnishingData(),U=e.fetchListingTypeData(),H=e.fetchStatusData();a.value.listing_type=U.find(i=>i.slug==="sale"),a.value.status=H.find(i=>i.slug==="active"),p.value.tenure=q.find(i=>i.slug==="freehold"),p.value.furnishing=T.find(i=>i.slug==="unfurnished");const K=async()=>{const i=await d.fetchStateList(w);V.value=i},Q=async()=>{const i=await d.fetchPropertyTypes(w);return k.value=i,i},se=()=>(P.value=_.value?1:0,P.value),le=i=>{a.value={...a.value,images:i.files,module_path:i.module_path,sequences:i.sequences}},ne=i=>{O.value=URL.createObjectURL(i.target.files[0]),G.value=i.target.files[0]},re=i=>{a.value.description=i},W=async()=>{const i=await Q(),h=await c.findProperty(w,r),{details:g}=h;a.value={...a.value,name:h.name,description:h.description,short_description:h.short_description,state:h.state,price:h.price,file:h.file,banner:h.banner,sliders:h.sliders,listing_type:h.listing_type,details:h.details_toggle,property_types:c.handleFilteredPropertyDetails(i,h.type,"propertyType")},a.value.short_description=a.value.short_description.replace(/<[^>]+>/g,""),a.value.listing_type=U.find(A=>A.slug===a.value.listing_type),_.value=a.value.details,g&&(p.value={...p.value,tenure:c.handleFilteredPropertyDetails(q,g.tenure),square_feet:g.square_feet,furnishing:c.handleFilteredPropertyDetails(T,g.furnishing),bedroom:g.bedroom,bathroom:g.bathroom,car_park:g.car_park})},ie=async()=>{if(a.value={...a.value,property_details:_.value?1:0,banner_url:G.value},a.value.property_details>0)a.value={...a.value,...p.value};else{const h=Object.keys(p.value),g=Object.fromEntries(Object.entries(a.value).filter(([A])=>!h.includes(A)));a.value=g}return await c.createProperty(w,a.value,m)};return o==="update"&&await W(),await K(),await Q(),{findProperty:W,propertyData:a,propertyDetailsData:p,submitData:ie,updateParentFiles:le,updateDescriptions:re,propertyDetailsToggle:_,handlePropertyDetails:se,options:n,errors:m,tenure:q,furnishing:T,listingType:U,status:H,state:V,property_types:k,stateList:K,propertyTypesList:Q,mainImage:I,bannerUrl:O,updateMainImage:ne,routeType:o,existImageModal:ae}}},Ne={class:"row"},Oe={class:"col-12 row pb-4"},Ge=t("div",{class:"col text-2xl"},"Property Form",-1),He={class:"col text-right"},Ke=t("span",{class:"font-bold"},"Details",-1),We={class:"col-12 row bg-white p-5 font-bold gap-y-4"},Je={class:"col-12 post-information-name pb-2"},Xe={class:"col-12"},Ye=t("div",{class:"post-information-name"},"Name",-1),Ze={class:"col-12"},$e={class:"col-12 text-red-700 pt-2"},et={class:"col-12"},tt=t("div",{class:"post-information-name"},"Descriptions",-1),ot={class:"col-12 prose max-w-none prose-strong:font-black prose-h1:text-7xl prose-h2:text-6xl prose-h3:text-5xl"},at={class:"col-12 text-red-700 pt-2"},st={class:"col-12"},lt=t("div",{class:"post-information-name"},"Short Descriptions",-1),nt={class:"col-12"},rt={class:"col-12 text-red-700 pt-2"},it=t("div",{class:"post-information-name"},"Status",-1),dt={class:"col-12 col-md-6"},ct=t("div",{class:"post-information-name"},"Types",-1),pt={class:"col-12 text-red-700 pt-2"},ut=t("div",{class:"post-information-name"},"State",-1),mt={class:"col-12 text-red-700 pt-2"},_t={class:"col-12 col-md-6"},ht=t("div",{class:"post-information-name"},"Price",-1),ft=t("div",{class:"post-information-name"},"Listing Type",-1),yt=t("div",{class:"post-information-name"},"Tenure",-1),gt={class:"col-12 col-md-6"},vt=t("div",{class:"post-information-name"},"Square Feet",-1),Dt=t("div",{class:"post-information-name"},"Furnished Type",-1),bt=t("div",{class:"post-information-name"},"Bathroom",-1),xt=t("div",{class:"post-information-name"},"Bedroom",-1),Vt={class:"col-12 col-md-6"},St=t("div",{class:"post-information-name"},"Car Park",-1),Ct={class:"col-12"},Ft={class:"flex justify-between py-2"},kt=t("div",{class:"post-information__name"},"Images",-1),It={key:0},wt={class:"col-12 text-red-700 pt-2"},Pt={class:"col-12 text-right"};function qt(l,o,r,e,d,c){const a=L("CkeditorPlugin"),p=L("ExistImageModal"),m=L("DropFile");return b(),x("div",Ne,[t("div",Oe,[Ge,t("div",He,[Ke,s(Ie,{modelValue:e.propertyDetailsToggle,"onUpdate:modelValue":o[0]||(o[0]=n=>e.propertyDetailsToggle=n),color:"green",onClick:e.handlePropertyDetails},null,8,["modelValue","onClick"])])]),t("div",We,[t("div",Je,y(e.routeType=="update"?"Update":"Create")+" Property ",1),t("div",Xe,[Ye,t("div",Ze,[s(D,{dense:"",outlined:"",label:"Name",modelValue:e.propertyData.name,"onUpdate:modelValue":o[1]||(o[1]=n=>e.propertyData.name=n),ref:"nameRef"},null,8,["modelValue"])]),t("div",$e,y(e.errors.name),1)]),t("div",et,[tt,t("div",ot,[s(a,{description:e.propertyData.description,onUpdateDescriptionsData:e.updateDescriptions},null,8,["description","onUpdateDescriptionsData"])]),t("div",at,y(e.errors.description),1)]),t("div",st,[lt,t("div",nt,[s(D,{modelValue:e.propertyData.short_description,"onUpdate:modelValue":o[2]||(o[2]=n=>e.propertyData.short_description=n),filled:"",outlined:"",placeholder:"Short Descriptions",type:"textarea"},null,8,["modelValue"])]),t("div",rt,y(e.errors.short_description),1)]),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[it,s(S,{dense:"",modelValue:e.propertyData.status,"onUpdate:modelValue":o[3]||(o[3]=n=>e.propertyData.status=n),options:e.status,"option-value":"slug","option-label":"label",label:"Status"},null,8,["modelValue","options"])],2),t("div",dt,[ct,s(S,{dense:"",modelValue:e.propertyData.property_types,"onUpdate:modelValue":o[4]||(o[4]=n=>e.propertyData.property_types=n),options:e.property_types,"option-value":"id","option-label":"label",label:"Please Select"},null,8,["modelValue","options"]),t("div",pt,y(e.errors.type_id),1)]),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[ut,s(S,{dense:"",modelValue:e.propertyData.state,"onUpdate:modelValue":o[5]||(o[5]=n=>e.propertyData.state=n),options:e.state,"option-value":"id","option-label":"label",label:"Please Select"},null,8,["modelValue","options"]),t("div",mt,y(e.errors.state_id),1)],2),t("div",_t,[ht,s(D,{dense:"",outlined:"",label:"Price",modelValue:e.propertyData.price,"onUpdate:modelValue":o[6]||(o[6]=n=>e.propertyData.price=n),type:"number"},null,8,["modelValue"])]),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[ft,s(S,{dense:"",modelValue:e.propertyData.listing_type,"onUpdate:modelValue":o[7]||(o[7]=n=>e.propertyData.listing_type=n),options:e.listingType,label:"Please Select","emit-value":"","map-options":""},null,8,["modelValue","options"])],2),t("div",{class:v(["col-12 row gap-y-4",e.propertyDetailsToggle?"":"hidden"])},[t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[yt,s(S,{dense:"",modelValue:e.propertyDetailsData.tenure,"onUpdate:modelValue":o[8]||(o[8]=n=>e.propertyDetailsData.tenure=n),options:e.tenure,label:"Please Select","emit-value":"","map-options":""},null,8,["modelValue","options"])],2),t("div",gt,[vt,s(D,{dense:"",outlined:"",label:"Square Feet",modelValue:e.propertyDetailsData.square_feet,"onUpdate:modelValue":o[9]||(o[9]=n=>e.propertyDetailsData.square_feet=n),type:"number"},null,8,["modelValue"])]),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[Dt,s(S,{dense:"",modelValue:e.propertyDetailsData.furnishing,"onUpdate:modelValue":o[10]||(o[10]=n=>e.propertyDetailsData.furnishing=n),options:e.furnishing,label:"Please Select","emit-value":"","map-options":""},null,8,["modelValue","options"])],2),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[bt,s(D,{dense:"",outlined:"",label:"Bathroom",modelValue:e.propertyDetailsData.bathroom,"onUpdate:modelValue":o[11]||(o[11]=n=>e.propertyDetailsData.bathroom=n),type:"number"},null,8,["modelValue"])],2),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[xt,s(D,{dense:"",outlined:"",label:"Bedroom",modelValue:e.propertyDetailsData.bedroom,"onUpdate:modelValue":o[12]||(o[12]=n=>e.propertyDetailsData.bedroom=n),type:"number"},null,8,["modelValue"])],2),t("div",Vt,[St,s(D,{dense:"",outlined:"",label:"Carpark",modelValue:e.propertyDetailsData.car_park,"onUpdate:modelValue":o[13]||(o[13]=n=>e.propertyDetailsData.car_park=n),type:"number"},null,8,["modelValue"])])],2),t("div",Ct,[t("div",Ft,[kt,e.routeType==="update"?(b(),x("div",It,[s(p,{property:e.propertyData},null,8,["property"])])):ue("",!0)]),s(m,{onUpdateFiles:e.updateParentFiles,propertyData:e.propertyData},null,8,["onUpdateFiles","propertyData"]),t("div",wt,y(e.errors.module_path),1)]),t("div",Pt,[s(F,{label:e.routeType=="update"?"Update":"Submit",class:"text-white bg-primary update-form__button",onClick:e.submitData},null,8,["label","onClick"])])])])}const to=te(ze,[["render",qt]]);export{to as default};
