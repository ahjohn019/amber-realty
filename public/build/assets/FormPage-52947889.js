import{l as X,E as A,d as de,u as ce,a9 as $,a as E,B as ee,r as h,n as b,x,D as s,s as f,R as pe,H as M,T as Y,A as t,F as B,G as y,m as j,W as v,U as ue}from"./ckeditor-02e744e5.js";import{c as me,Q as _e}from"./vm-8d870a05.js";import{u as he,a as fe,b as ye}from"./use-checkbox-4fd9df1c.js";import{Q as D}from"./QInput-0a75a164.js";import{Q as S}from"./QSelect-6b7c8cc4.js";import{Q as I}from"./QBtn-06ca8513.js";import{C as ge,D as ve,u as De}from"./refList-ea54f7de.js";import{a as be,u as xe}from"./index-ce0d7982.js";import{S as L,u as te}from"./app-7537ec3c.js";import{Q as Ve,a as Se}from"./QCardActions-f5009174.js";import{Q as C}from"./QCardSection-0ce48cb2.js";import{Q as Ce}from"./QImg-552d92c1.js";import{Q as R}from"./QChip-f21ec7ff.js";import{Q as Z}from"./QCard-0fcf7a53.js";import{Q as Ie}from"./QDialog-32a3201d.js";import{C as Fe}from"./ClosePopup-602f2a34.js";import"./option-sizes-804a0e0d.js";import"./QMenu-2677335d.js";import"./use-tick-5c90f11d.js";import"./rtl-36dd996b.js";import"./format-7985d814.js";import"./use-prevent-scroll-16ed7031.js";const ke=me({name:"QToggle",props:{...he,icon:String,iconColor:String},emits:fe,setup(l){function o(r,e){const d=X(()=>(r.value===!0?l.checkedIcon:e.value===!0?l.indeterminateIcon:l.uncheckedIcon)||l.icon),p=X(()=>r.value===!0?l.iconColor:null);return()=>[A("div",{class:"q-toggle__track"}),A("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},d.value!==void 0?[A(_e,{name:d.value,color:p.value})]:void 0)]}return ye("toggle",o)}}),z="/api/server-files/",Pe=de("server_image_admin",{state:()=>({post_image_admin:null,router:ce(),route:$()}),actions:{async updateFiles(l,o){const r={headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}};try{const e=await E.post(z+"update",l,r);return L.fire({text:"Image Update Successfully",icon:"success"}).then(d=>{d.isConfirmed&&this.router.go(0)}),e.data}catch(e){return L.fire({title:e.response.data.data,text:e.response.data.message,icon:"error"}),e.response}},async deleteFiles(l,o){const r={headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}};try{const e=await E.post(z+"delete",l,r);return L.fire({text:"Image Deleted Successfully",icon:"success"}).then(d=>{d.isConfirmed&&this.router.go(0)}),e.data}catch(e){throw console.error("Error:",e),e}},findIncomingFiles(l,o){return l.value.find(r=>r.id===o)||null},handleMultipleImageChange(l,o){const r=o.target,e=parseInt(r.id),d=r.files[0],p=r.getAttribute("index"),a=r.getAttribute("module_path");return this.findIncomingFiles(l,e)?l.value[p].file=d:l.value.push({id:e,file:d,module_path:a}),l},async updateSequence(l,o){const r={headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}};try{const e=await E.post(z+"sequence",l,r);console.log(e.data)}catch{}},handleExistImageSequence(l,o=null){const{eventTarget:r,incomingFiles:e,fileId:d}=l,p=r.getAttribute("index"),a=r.getAttribute("module_path"),u=this.findIncomingFiles(e,d);let c=null;u?(c={...e.value[p]},e.value[p].sequence=r.value):e.value.push({id:d,sequences:r.value,module_path:a});const n={id:d,sequences:parseInt(r.value),module_path:a,previous_sequences:parseInt(c==null?void 0:c.sequences)||1};return console.log(n),this.updateSequence(n,o),e.value}}});const qe={props:["property"],setup(l){const o=te(),r=Pe(),e=o.fetchSessionToken(),d=h(!1),p=h([]),a=[l.property.banner,...l.property.sliders].filter(m=>m!==null);return{existImageModal:d,updateFileData:async()=>{const m=await r.updateFiles(p.value,e);return d.value=!1,m},handleFileChange:m=>r.handleMultipleImageChange(p,m),handleDeleteFile:async m=>{const V=await r.deleteFiles(m,e);return d.value=!1,V},finalFiles:a,handleExistImageSequence:(m,V)=>{const F={eventTarget:m.target,fileId:V,incomingFiles:p};return r.handleExistImageSequence(F,e)}}}},we=t("div",{class:"text-h5"},"Edit",-1),Te={class:"col row"},Ue={class:"col"},Qe={class:"text-subtitle1 break-words"},Ae={class:"text-subtitle2"},Ee={class:"text-subtitle2"},Me=["id","index","module_path","onChange"],Be=["value","selected"],je=["id","module_path","index"];function Le(l,o,r,e,d,p){return b(),x(M,null,[s(I,{label:"Edit",color:"primary",onClick:o[0]||(o[0]=a=>e.existImageModal=!0),class:"edit-image-form__button"}),s(Ie,{modelValue:e.existImageModal,"onUpdate:modelValue":o[2]||(o[2]=a=>e.existImageModal=a)},{default:f(()=>[s(Z,null,{default:f(()=>[s(C,{class:"row items-center"},{default:f(()=>[we,s(Ve),pe(s(I,{icon:"close",flat:"",round:"",dense:""},null,512),[[Fe]])]),_:1}),s(C,{class:"q-pt-none q-gutter-y-lg row"},{default:f(()=>[(b(!0),x(M,null,Y(e.finalFiles,(a,u)=>(b(),x("div",{class:"col-12 row items-center",key:u},[t("div",Te,[t("div",Ue,[s(Z,{class:"my-card"},{default:f(()=>[s(Ce,{src:a.image.url,ratio:16/9,fit:"contain"},null,8,["src"]),s(C,null,{default:f(()=>[t("div",Qe,[s(R,{color:"primary","text-color":"white"},{default:f(()=>[B(y(a.image.name),1)]),_:2},1024)]),t("div",Ae,[s(R,{color:"teal","text-color":"white",icon:"bookmark"},{default:f(()=>[B(y(Math.round(a.image.size/1e3)+"kb"),1)]),_:2},1024)]),t("div",Ee,[s(R,{color:"teal","text-color":"white",icon:"bookmark"},{default:f(()=>[B(y(a.image.module_path),1)]),_:2},1024)]),t("div",null,[t("select",{name:"",id:parseInt(a.id),index:u,module_path:a.image.module_path,onChange:c=>e.handleExistImageSequence(c,a.id)},[(b(!0),x(M,null,Y(e.finalFiles.length,(c,n)=>(b(),x("option",{value:c,key:n,selected:a.seq_value===c},y(c),9,Be))),128))],40,Me)])]),_:2},1024),s(C,{class:"justify-center flex"},{default:f(()=>[s(C,{class:"col-8"},{default:f(()=>[t("input",{type:"file",multiple:"",name:"file",id:a.id,module_path:a.image.module_path,index:u,class:"hidden-input",onChange:o[1]||(o[1]=(...c)=>e.handleFileChange&&e.handleFileChange(...c)),ref_for:!0,ref:"currentFile",accept:".pdf,.jpg,.jpeg,.png"},null,40,je)]),_:2},1024)]),_:2},1024),s(C,{class:"justify-center flex"},{default:f(()=>[s(I,{size:"14px",round:"",color:"red",icon:"delete",onClick:c=>e.handleDeleteFile(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])])]))),128))]),_:1}),s(Se,{align:"right"},{default:f(()=>[s(I,{label:"Update",class:"text-white bg-primary update-form__button",onClick:e.updateFileData},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const Re=ee(qe,[["render",Le]]);const ze={components:{CkeditorPlugin:ge,DropFile:ve,ExistImageModal:Re},async setup(){var W,J;const l=$(),o=((W=l.query)==null?void 0:W.type)||null,r=((J=l.query)==null?void 0:J.id)||null,e=be(),d=De(),p=xe(),a=h(e.fetchPropertyData()),u=h(e.fetchPropertyDetailsData()),c=h(e.fetchPropertyError()),n=h([]),P=h(0),m=h(!1),V=h([]),F=h([]),oe=h(null),N=h(""),O=h(""),ae=h(!1),k=te().fetchSessionToken(),q=e.fetchTenureData(),w=e.fetchFurnishingData(),T=e.fetchListingTypeData(),G=e.fetchStatusData();a.value.listing_type=T.find(i=>i.slug==="sale"),a.value.status=G.find(i=>i.slug==="active"),u.value.tenure=q.find(i=>i.slug==="freehold"),u.value.furnishing=w.find(i=>i.slug==="unfurnished");const H=async()=>{const i=await d.fetchStateList(k);V.value=i},U=async()=>{const i=await d.fetchPropertyTypes(k);return F.value=i,i},se=()=>(P.value=m.value?1:0,P.value),le=i=>{a.value={...a.value,images:i.files,module_path:i.module_path,sequences:i.sequences}},ne=i=>{N.value=URL.createObjectURL(i.target.files[0]),O.value=i.target.files[0]},re=i=>{a.value.description=i},K=async()=>{const i=await U(),_=await p.findProperty(k,r),{details:g}=_;a.value={...a.value,name:_.name,description:_.description,short_description:_.short_description,state:_.state,price:_.price,file:_.file,banner:_.banner,sliders:_.sliders,listing_type:_.listing_type,details:_.details_toggle,property_types:p.handleFilteredPropertyDetails(i,_.type,"propertyType")},a.value.short_description=a.value.short_description.replace(/<[^>]+>/g,""),a.value.listing_type=T.find(Q=>Q.slug===a.value.listing_type),m.value=a.value.details,g&&(u.value={...u.value,tenure:p.handleFilteredPropertyDetails(q,g.tenure),square_feet:g.square_feet,furnishing:p.handleFilteredPropertyDetails(w,g.furnishing),bedroom:g.bedroom,bathroom:g.bathroom,car_park:g.car_park})},ie=async()=>{if(a.value={...a.value,property_details:m.value?1:0,banner_url:O.value},a.value.property_details>0)a.value={...a.value,...u.value};else{const _=Object.keys(u.value),g=Object.fromEntries(Object.entries(a.value).filter(([Q])=>!_.includes(Q)));a.value=g}return await p.createProperty(k,a.value,c)};return o==="update"&&await K(),await H(),await U(),{findProperty:K,propertyData:a,propertyDetailsData:u,submitData:ie,updateParentFiles:le,updateDescriptions:re,propertyDetailsToggle:m,handlePropertyDetails:se,options:n,errors:c,tenure:q,furnishing:w,listingType:T,status:G,state:V,property_types:F,stateList:H,propertyTypesList:U,mainImage:oe,bannerUrl:N,updateMainImage:ne,routeType:o,existImageModal:ae}}},Ne={class:"row"},Oe={class:"col-12 row pb-4"},Ge=t("div",{class:"col text-2xl"},"Property Form",-1),He={class:"col text-right"},Ke=t("span",{class:"font-bold"},"Details",-1),We={class:"col-12 row bg-white p-5 font-bold gap-y-4"},Je={class:"col-12 post-information-name pb-2"},Xe={class:"col-12"},Ye=t("div",{class:"post-information-name"},"Name",-1),Ze={class:"col-12"},$e={class:"col-12 text-red-700 pt-2"},et={class:"col-12"},tt=t("div",{class:"post-information-name"},"Descriptions",-1),ot={class:"col-12 prose max-w-none prose-strong:font-black prose-h1:text-7xl prose-h2:text-6xl prose-h3:text-5xl"},at={class:"col-12 text-red-700 pt-2"},st={class:"col-12"},lt=t("div",{class:"post-information-name"},"Short Descriptions",-1),nt={class:"col-12"},rt={class:"col-12 text-red-700 pt-2"},it=t("div",{class:"post-information-name"},"Status",-1),dt={class:"col-12 col-md-6"},ct=t("div",{class:"post-information-name"},"Types",-1),pt={class:"col-12 text-red-700 pt-2"},ut=t("div",{class:"post-information-name"},"State",-1),mt={class:"col-12 text-red-700 pt-2"},_t={class:"col-12 col-md-6"},ht=t("div",{class:"post-information-name"},"Price",-1),ft=t("div",{class:"post-information-name"},"Listing Type",-1),yt=t("div",{class:"post-information-name"},"Tenure",-1),gt={class:"col-12 col-md-6"},vt=t("div",{class:"post-information-name"},"Square Feet",-1),Dt=t("div",{class:"post-information-name"},"Furnished Type",-1),bt=t("div",{class:"post-information-name"},"Bathroom",-1),xt=t("div",{class:"post-information-name"},"Bedroom",-1),Vt={class:"col-12 col-md-6"},St=t("div",{class:"post-information-name"},"Car Park",-1),Ct={class:"col-12"},It={class:"flex justify-between py-2"},Ft=t("div",{class:"post-information__name"},"Images",-1),kt={key:0},Pt={class:"col-12 text-red-700 pt-2"},qt={class:"col-12 text-right"};function wt(l,o,r,e,d,p){const a=j("CkeditorPlugin"),u=j("ExistImageModal"),c=j("DropFile");return b(),x("div",Ne,[t("div",Oe,[Ge,t("div",He,[Ke,s(ke,{modelValue:e.propertyDetailsToggle,"onUpdate:modelValue":o[0]||(o[0]=n=>e.propertyDetailsToggle=n),color:"green",onClick:e.handlePropertyDetails},null,8,["modelValue","onClick"])])]),t("div",We,[t("div",Je,y(e.routeType=="update"?"Update":"Create")+" Property ",1),t("div",Xe,[Ye,t("div",Ze,[s(D,{dense:"",outlined:"",label:"Name",modelValue:e.propertyData.name,"onUpdate:modelValue":o[1]||(o[1]=n=>e.propertyData.name=n),ref:"nameRef"},null,8,["modelValue"])]),t("div",$e,y(e.errors.name),1)]),t("div",et,[tt,t("div",ot,[s(a,{description:e.propertyData.description,onUpdateDescriptionsData:e.updateDescriptions},null,8,["description","onUpdateDescriptionsData"])]),t("div",at,y(e.errors.description),1)]),t("div",st,[lt,t("div",nt,[s(D,{modelValue:e.propertyData.short_description,"onUpdate:modelValue":o[2]||(o[2]=n=>e.propertyData.short_description=n),filled:"",outlined:"",placeholder:"Short Descriptions",type:"textarea"},null,8,["modelValue"])]),t("div",rt,y(e.errors.short_description),1)]),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[it,s(S,{dense:"",modelValue:e.propertyData.status,"onUpdate:modelValue":o[3]||(o[3]=n=>e.propertyData.status=n),options:e.status,"option-value":"slug","option-label":"label",label:"Status"},null,8,["modelValue","options"])],2),t("div",dt,[ct,s(S,{dense:"",modelValue:e.propertyData.property_types,"onUpdate:modelValue":o[4]||(o[4]=n=>e.propertyData.property_types=n),options:e.property_types,"option-value":"id","option-label":"label",label:"Please Select"},null,8,["modelValue","options"]),t("div",pt,y(e.errors.type_id),1)]),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[ut,s(S,{dense:"",modelValue:e.propertyData.state,"onUpdate:modelValue":o[5]||(o[5]=n=>e.propertyData.state=n),options:e.state,"option-value":"id","option-label":"label",label:"Please Select"},null,8,["modelValue","options"]),t("div",mt,y(e.errors.state_id),1)],2),t("div",_t,[ht,s(D,{dense:"",outlined:"",label:"Price",modelValue:e.propertyData.price,"onUpdate:modelValue":o[6]||(o[6]=n=>e.propertyData.price=n),type:"number"},null,8,["modelValue"])]),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[ft,s(S,{dense:"",modelValue:e.propertyData.listing_type,"onUpdate:modelValue":o[7]||(o[7]=n=>e.propertyData.listing_type=n),options:e.listingType,label:"Please Select","emit-value":"","map-options":""},null,8,["modelValue","options"])],2),t("div",{class:v(["col-12 row gap-y-4",e.propertyDetailsToggle?"":"hidden"])},[t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[yt,s(S,{dense:"",modelValue:e.propertyDetailsData.tenure,"onUpdate:modelValue":o[8]||(o[8]=n=>e.propertyDetailsData.tenure=n),options:e.tenure,label:"Please Select","emit-value":"","map-options":""},null,8,["modelValue","options"])],2),t("div",gt,[vt,s(D,{dense:"",outlined:"",label:"Square Feet",modelValue:e.propertyDetailsData.square_feet,"onUpdate:modelValue":o[9]||(o[9]=n=>e.propertyDetailsData.square_feet=n),type:"number"},null,8,["modelValue"])]),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[Dt,s(S,{dense:"",modelValue:e.propertyDetailsData.furnishing,"onUpdate:modelValue":o[10]||(o[10]=n=>e.propertyDetailsData.furnishing=n),options:e.furnishing,label:"Please Select","emit-value":"","map-options":""},null,8,["modelValue","options"])],2),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[bt,s(D,{dense:"",outlined:"",label:"Bathroom",modelValue:e.propertyDetailsData.bathroom,"onUpdate:modelValue":o[11]||(o[11]=n=>e.propertyDetailsData.bathroom=n),type:"number"},null,8,["modelValue"])],2),t("div",{class:v(["col-12 col-md-6",l.$q.screen.lt.md?"pr-0":"pr-6"])},[xt,s(D,{dense:"",outlined:"",label:"Bedroom",modelValue:e.propertyDetailsData.bedroom,"onUpdate:modelValue":o[12]||(o[12]=n=>e.propertyDetailsData.bedroom=n),type:"number"},null,8,["modelValue"])],2),t("div",Vt,[St,s(D,{dense:"",outlined:"",label:"Carpark",modelValue:e.propertyDetailsData.car_park,"onUpdate:modelValue":o[13]||(o[13]=n=>e.propertyDetailsData.car_park=n),type:"number"},null,8,["modelValue"])])],2),t("div",Ct,[t("div",It,[Ft,e.routeType==="update"?(b(),x("div",kt,[s(u,{property:e.propertyData},null,8,["property"])])):ue("",!0)]),s(c,{onUpdateFiles:e.updateParentFiles,propertyData:e.propertyData},null,8,["onUpdateFiles","propertyData"]),t("div",Pt,y(e.errors.module_path),1)]),t("div",qt,[s(I,{label:e.routeType=="update"?"Update":"Submit",class:"text-white bg-primary update-form__button",onClick:e.submitData},null,8,["label","onClick"])])])])}const to=ee(ze,[["render",wt]]);export{to as default};
